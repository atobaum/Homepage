function manualSelectBook(){for(var o=0;o<authors.length;o++)delete authors[o].text;var e={};e.title=$('#manual_book_form input[name="title"]').val(),e.publisher=$('#manual_book_form input[name="publisher"]').val(),e.published_date=$('#manual_book_form input[name="published_date"]').val();var a=$('#manual_book_form input[name="isbn"]').val();return e.isbn13=10==a.length?"978"+a:a,e.cover_URL=$('#manual_book_form input[name="cover_URL"]').val(),e.subtitle=$('#manual_book_form input[name="subtitle"]').val(),e.original_title=$('#manual_book_form input[name="original_title"]').val(),e.pages=$('#manual_book_form input[name="pages"]').val(),e.authors=authors,setBook(e),$(".modal").modal("hide"),!1}function resetBook(){$("#form_isbn13").val(""),$("#form_book").val(""),$("#book_panel").hide(),$("#btns_add_book").show()}function selectBook(o){$.ajax({url:"/bookshelf/api/bookinfo/aladin?isbn13="+o,dataType:"json",success:function(o){if(0===o.ok)return void console.log("error");setBook(o.result)}})}function formatAuthors(o){var e="";for(var a in o){var t=o[a];switch(e+=t.name,t.type){case"author":e+=" 지음, ";break;case"translator":e+=" 번역, ";break;case"supervisor":e+=" 감수, ";break;case"illustrator":e+=" 그림, "}}return e=e.substring(0,e.length-2)+"."}function setBook(o){$("#form_isbn13").val(o.isbn13),$("#book_cover").attr("src",o.cover_URL),$("#book_title").text(o.title),$("#book_authors").text(formatAuthors(o.authors)),$("#book_publish").text(o.publisher+" | "+o.published_date),$(".ui.search").search("set value",""),$("#book_list_wrapper").hide(),$("#book_panel").show(),$("#btns_add_book").hide(),$("#form_book").val(JSON.stringify(o))}function searchBookByKeyword(o,e){$.ajax({url:"/bookshelf/api/searchbook?keyword="+o,dataType:"json",success:function(o){var e=$("#book_list");e.empty(),$.each(o,function(o,a){e.append($("<li />",{id:"book_"+o,text:a.title,class:"book"})),$("#book_"+o).attr(a).click(selectBook).hover(hoverBook)}),$("#book_list_wrapper").show()}})}function check_form(){$("form .field").removeClass("error"),$("form .ui.message").hide();var o=!0,e="";return 0===$("#form_book").val().length&&(e+="책을 선택하세요. ",o=!1),o||($(".ui.message p").text(e),$("form .ui.message").addClass("error"),$("form .ui.message").show()),$("#form_rating").val(2*$(".rating").starRating("getRating")),$('form input[type="checkbox"]').prop("checked")?$('form input[name="is_secret"]').val(1):$('form input[name="is_secret"]').val(0),o}function DelayedHandler(){this.timer=null,this.handler="",this.millisec="",this.start=function(o,e){this.timer&&clearInterval(this.timer),this.timer=setTimeout(o,e)}}var authors=[],authorTypeTrans={"저자":"author","역자":"translator","감수":"supervisor","그림":"illustrator","사진":"photo"};$(document).ready(function(){$(".remove.icon").parent().click(function(){$(".modal").modal("hide")}),$(".ui.modal").modal(),$("#btn_manual_book").click(function(){$(".ui.modal").modal("show")}),$("#book_panel").hide(),$("#book_search").keyup(function(){var o=$("#book_search").val();0===o.length?($("#book_list_wrapper").hide(),$("#book_search_bar").removeClass("loading")):($("#book_search_bar").addClass("loading"),delayedHnadlerForTitle.start(function(){searchBookByKeyword(o),$("#book_search_bar").removeClass("loading")},1500))}),$("#book_search").focus(function(){0!==$("#book_search").val().length&&$("#book_list_wrapper").show()}),$(".ui.search").search({apiSettings:{url:"/bookshelf/api/searchbook?keyword={query}"},searchDelay:1e3,onSelect:function(o,e){selectBook(o.isbn13),$("#form_date_started").focus()}}),$(".rating").starRating({starShape:"rounded",starSize:25,disableAfterRate:!1}),$("#mod_btn").click(function(){$("form *").removeAttr("readonly"),$(".rating").starRating("setReadOnly",!1),$(".ui.buttons").show(),$(this).hide()}),$("#can_btn").click(function(){$(".rating").starRating("setRating",parseInt($("#form_rating").val())/2),resetBook()}),$("#change_book").click(function(){resetBook()}),$("#manual_authors .multiple.selection").dropdown({allowAdditions:!0,action:function(o,e){var a=$("#manual_author_type").dropdown("get text"),t=authorTypeTrans[a];authors.push({name:o,type:t,text:o+"("+a+")"}),$("#manual_authors .multiple.selection").dropdown("set selected",[o+"("+a+")"])},onRemove:function(o){for(var e=0;e<authors.length;e++){if(o==authors[e].text)return void authors.splice(e,1)}}}),$("#manual_authors input.search").keydown(function(o){switch(o.which){case 38:var e=$("#manual_author_type").dropdown("get value");$("#manual_author_type").dropdown("set selected",parseInt(e)-1);break;case 40:var e=$("#manual_author_type").dropdown("get value");$("#manual_author_type").dropdown("set selected",parseInt(e)+1)}}),$("#manual_author_type").dropdown("set selected",1)});