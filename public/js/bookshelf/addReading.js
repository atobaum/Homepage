function manualSelectBook(){for(var e=0;e<authors.length;e++)delete authors[e].text;var t={},a=$("#manual_book_form");t.title=a.find('input[name="title"]').val(),t.publisher=a.find('input[name="publisher"]').val(),t.published_date=a.find('input[name="published_date"]').val();var o=a.find('input[name="isbn"]').val();return t.isbn13=10===o.length?"978"+o:o,t.cover_URL=a.find('input[name="cover_URL"]').val(),t.subtitle=a.find('input[name="subtitle"]').val(),t.original_title=a.find('input[name="original_title"]').val(),t.pages=a.find('input[name="pages"]').val(),t.authors=authors,setBook(t),$(".modal").modal("hide"),!1}function resetBook(){$("#form_isbn13").val(""),$("#form_book").val(""),$("#book_panel").hide(),$("#btns_add_book").show()}function openManualBookForm(e,t){authors=[];var a=$("#manual_book_form");if(t){var o=a.parent().find(".ui.message");o.addClass("negative"),o.find(".header").text(t.head),o.find("p").text(t.content),o.show()}e&&(a.find('input[name="title"]').val(e.title),a.find('input[name="publisher"]').val(e.publisher),a.find('input[name="published_date"]').val(e.published_date),a.find('input[name="isbn"]').val(e.isbn13),a.find('input[name="cover_URL"]').val(e.cover_URL),a.find('input[name="original_title"]').val(e.original_title),a.find('input[name="pages"]').val(e.pages)),$("#manual_author_type").dropdown("clear"),$("#manual_author_type").dropdown("set selected",1),$(".modal.small").modal("show")}function selectBook(e){$.ajax({url:"/bookshelf/api/bookinfo/aladin?isbn13="+e.isbn13,dataType:"json",success:function(t){if(0===t.ok)return console.log("error: ",t.error),void openManualBookForm(e,{head:"책 자동 추가 실패.",content:"책정보를 수동으로 입력해주세요."});e=t.result,e.authors?setBook(e):openManualBookForm(e,{head:"책 자동 추가 실패. 저자를 수동으로 추가해주세요.",content:"저자: "+e.authorsText})}})}function formatAuthors(e){var t="";for(var a in e){var o=e[a];switch(t+=o.name,o.type){case"author":t+=" 지음, ";break;case"translator":t+=" 번역, ";break;case"supervisor":t+=" 감수, ";break;case"illustrator":t+=" 그림, ";break;case"editor":t+=" 엮음, "}}return t=t.substring(0,t.length-2)+"."}function setBook(e){$("#form_isbn13").val(e.isbn13),$("#book_cover").attr("src",e.cover_URL),$("#book_title").text(e.title),$("#book_authors").text(formatAuthors(e.authors)),$("#book_publish").text(e.publisher+" | "+e.published_date),$(".ui.search").search("set value",""),$("#book_list_wrapper").hide(),$("#book_panel").show(),$("#btns_add_book").hide(),$("#form_book").val(JSON.stringify(e)),$("#manual_authors .message").hide()}function check_form(){$("form .field").removeClass("error"),$("form .ui.message").hide();var e=!0,t="";return 0===$("#form_book").val().length&&(t+="책을 선택하세요. ",e=!1),e||($(".ui.message p").text(t),$("form .ui.message").addClass("error"),$("form .ui.message").show()),$("#form_rating").val(2*$(".rating").starRating("getRating")),$('form input[type="checkbox"]').prop("checked")?$('form input[name="is_secret"]').val(1):$('form input[name="is_secret"]').val(0),e}var authors=[],authorTypeTrans={"저자":"author","역자":"translator","감수":"supervisor","그림":"illustrator","사진":"photo","엮음":"editor"};$(document).ready(function(){$(".remove.icon").parent().click(function(){$(".modal").modal("hide")}),$(".ui.modal").modal(),$("#btn_manual_book").click(function(){$(".ui.modal").modal("show")}),$("#book_panel").hide(),$(".ui.search").search({apiSettings:{url:"/bookshelf/api/searchbook?keyword={query}",onResponse:function(e){return $.each(e.result,function(e,t){t.desc=t.author+" | "+t.publisher+" | "+t.published_date}),e}},searchDelay:1e3,onSelect:function(e,t){e.isbn13.length,selectBook(e),$("#form_date_started").focus()},fields:{results:"result",description:"desc",image:"cover_URL"}}),$(".rating").starRating({starShape:"rounded",starSize:25,disableAfterRate:!1}),$("#mod_btn").click(function(){$("form *").removeAttr("readonly"),$(".rating").starRating("setReadOnly",!1),$(".ui.buttons").show(),$(this).hide()}),$("#can_btn").click(function(){$(".rating").starRating("setRating",parseInt($("#form_rating").val())/2),resetBook()}),$("#change_book").click(function(){resetBook()}),$("#manual_authors .multiple.selection").dropdown({allowAdditions:!0,action:function(e,t){var a=$("#manual_author_type").dropdown("get text"),o=authorTypeTrans[a];authors.push({name:e,type:o,text:e+"("+a+")"}),$("#manual_authors .multiple.selection").dropdown("set selected",[e+"("+a+")"])},onRemove:function(e){for(var t=0;t<authors.length;t++){if(e==authors[t].text)return void authors.splice(t,1)}}}),$("#manual_authors input.search").keydown(function(e){switch(e.which){case 38:var t=$("#manual_author_type").dropdown("get value");$("#manual_author_type").dropdown("set selected",parseInt(t)-1);break;case 40:var t=$("#manual_author_type").dropdown("get value");$("#manual_author_type").dropdown("set selected",parseInt(t)+1)}}),$("#manual_author_type").dropdown("set selected",1)});